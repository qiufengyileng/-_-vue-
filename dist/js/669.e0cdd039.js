"use strict";(self["webpackChunkshop_demo"]=self["webpackChunkshop_demo"]||[]).push([[669],{3669:function(t,s,a){a.r(s),a.d(s,{default:function(){return C}});a(4114);var i=function(){var t=this,s=t._self._c;return s("div",{staticClass:"prodetail"},[s("van-nav-bar",{attrs:{fixed:"",title:"商品详情页","left-arrow":""},on:{"click-left":function(s){return t.$router.go(-1)}}}),s("van-swipe",{attrs:{autoplay:3e3},on:{change:t.onChange},scopedSlots:t._u([{key:"indicator",fn:function(){return[s("div",{staticClass:"custom-indicator"},[t._v(t._s(t.current+1)+" / "+t._s(t.images.length))])]},proxy:!0}])},t._l(t.images,(function(t,a){return s("van-swipe-item",{key:a},[s("img",{attrs:{src:t.external_url}})])})),1),s("div",{staticClass:"info"},[s("div",{staticClass:"title"},[s("div",{staticClass:"price"},[s("span",{staticClass:"now"},[t._v("￥"+t._s(t.detail.goods_price_min))]),s("span",{staticClass:"oldprice"},[t._v("￥"+t._s(t.detail.goods_price_max))])]),s("div",{staticClass:"sellcount"},[t._v("已售"+t._s(t.detail.goods_sales)+"件")])]),s("div",{staticClass:"msg text-ellipsis-2"},[t._v(" "+t._s(t.detail.goods_name)+" ")]),s("div",{staticClass:"service"},[s("div",{staticClass:"left-words"},[s("span",[s("van-icon",{attrs:{name:"passed"}}),t._v("七天无理由退货")],1),s("span",[s("van-icon",{attrs:{name:"passed"}}),t._v("48小时发货")],1)]),s("div",{staticClass:"right-icon"},[s("van-icon",{attrs:{name:"arrow"}})],1)])]),s("div",{staticClass:"comment"},[s("div",{staticClass:"comment-title"},[s("div",{staticClass:"left"},[t._v("商品评价 ("+t._s(t.comTotal)+"条)")]),s("div",{staticClass:"right"},[t._v("查看更多 "),s("van-icon",{attrs:{name:"arrow"}})],1)]),s("div",{staticClass:"comment-list"},t._l(t.comList,(function(a){return s("div",{key:a.comment_id,staticClass:"comment-item"},[s("div",{staticClass:"top"},[s("img",{attrs:{src:a.user.avatar_url||"https://img.51miz.com/Element/00/77/29/33/91080072_E772933_8c62ebf4.png",alt:""}}),s("div",{staticClass:"name"},[t._v(t._s(a.user.nick_name))]),s("van-rate",{attrs:{size:16,value:5,color:"#ffd21e","void-icon":"star","void-color":"#eee"}})],1),s("div",{staticClass:"content"},[t._v(" "+t._s(a.content)+" ")]),s("div",{staticClass:"time"},[t._v(" "+t._s(a.create_time)+" ")])])})),0)]),s("div",{staticClass:"desc",domProps:{innerHTML:t._s(t.detail.content)}}),s("div",{staticClass:"footer"},[s("div",{staticClass:"icon-home",on:{click:function(s){return t.$router.push("/home")}}},[s("van-icon",{attrs:{name:"wap-home-o"}}),s("span",[t._v("首页")])],1),s("div",{staticClass:"icon-cart",on:{click:function(s){return t.$router.push("/cart")}}},[s("van-icon",{attrs:{name:"shopping-cart-o",badge:t.total}}),s("span",[t._v("购物车")])],1),s("div",{staticClass:"btn-add",on:{click:function(s){return t.addCart()}}},[t._v("加入购物车")]),s("div",{staticClass:"btn-buy",on:{click:function(s){return t.buy()}}},[t._v("立刻购买")])]),s("van-action-sheet",{attrs:{title:"buy"===t.mode?"立即购买":"加入购物车"},model:{value:t.show,callback:function(s){t.show=s},expression:"show"}},[s("div",{staticClass:"product"},[s("div",{staticClass:"product-title"},[s("div",{staticClass:"left"},[s("img",{attrs:{src:t.images[0].external_url,alt:""}})]),s("div",{staticClass:"right"},[s("div",{staticClass:"price"},[s("span",[t._v("¥")]),s("span",{staticClass:"nowprice"},[t._v(t._s(t.detail.goods_price_min))])]),s("div",{staticClass:"count"},[s("span",[t._v("库存")]),s("span",[t._v(t._s(t.detail.stock_total))])])])]),s("div",{staticClass:"num-box"},[s("span",[t._v("数量")]),s("CountBox",{model:{value:t.count,callback:function(s){t.count=s},expression:"count"}})],1),t.detail.stock_total>0?s("div",{staticClass:"showbtn"},["cart"===t.mode?s("div",{staticClass:"btn",on:{click:t.addcart}},[t._v("加入购物车")]):s("div",{staticClass:"btn now",on:{click:t.productToPay}},[t._v("立刻购买")])]):s("div",{staticClass:"btn-none"},[t._v("该商品已抢完")])])])],1)},e=[],o=a(5281),n=function(){var t=this,s=t._self._c;return s("div",{staticClass:"CountBox"},[s("button",{staticClass:"minus",on:{click:t.handleSub}},[t._v("-")]),s("input",{staticClass:"inp",attrs:{type:"text"},domProps:{value:t.value},on:{change:t.handleChange}}),s("button",{staticClass:"add",on:{click:t.handleAdd}},[t._v("+")])])},c=[],l={props:{value:Number},methods:{handleSub(){this.value<=1||this.$emit("input",this.value-1)},handleAdd(){this.$emit("input",this.value+1)},handleChange(t){const s=+t.target.value;isNaN(s)||s<=0||s%1!==0?t.target.value=this.value:this.$emit("input",s)}}},r=l,d=a(1656),u=(0,d.A)(r,n,c,!1,null,"15da9802",null),v=u.exports,h=a(9652),m=a(3518),p={name:"ProDetail",components:{CountBox:v},async created(){const{data:{detail:t}}=await(0,o.B7)(this.id);this.detail=t,this.images=t.goods_images;const{data:{list:s,total:a}}=await(0,o.ku)(this.id);this.comList=s,this.comTotal=a,console.log(s),this.$store.dispatch("cart/getCartList")},computed:{id(){return this.$route.query.id},...(0,m.L8)("cart",["total"])},data(){return{images:[],current:0,detail:{},comList:[],comTotal:0,show:!1,mode:"",count:1,cartTotal:""}},methods:{onChange(t){this.current=t},buy(){this.show=!0,this.mode="buy"},addCart(){this.show=!0,this.mode="cart"},async addcart(){if(this.$store.state.user.userInfo.token){const t=await(0,h.Qw)(this.detail.goods_id,this.count,this.detail.skuList[0].goods_sku_id);"加入购物车成功"===t.message?(this.$store.dispatch("cart/getCartList"),this.$toast.success("加入购物车成功")):this.$toast.fail("出现错误了")}else this.$dialog.confirm({title:"温馨提示",message:"请先完成登录再进行以下操作",confirmButtonText:"去登录",cancelButtonText:"再逛逛"}).then((()=>{this.$router.replace({path:"/login",query:{backUrl:this.$route.fullPath}})})).catch((()=>{}))},productToPay(){this.$store.state.user.userInfo.token?this.$router.push({path:"/pay",query:{mode:"buyNow",goodsId:this.detail.goods_id,goodsNum:this.count,goodsSkuId:this.detail.skuList[0].goods_sku_id}}):this.$dialog.confirm({title:"温馨提示",message:"请先完成登录再进行以下操作",confirmButtonText:"去登录",cancelButtonText:"再逛逛"}).then((()=>{this.$router.replace({path:"/login",query:{backUrl:this.$route.fullPath}})})).catch((()=>{}))}}},_=p,g=(0,d.A)(_,i,e,!1,null,"c8f2e4e6",null),C=g.exports},5281:function(t,s,a){a.d(s,{B7:function(){return o},Cd:function(){return e},ku:function(){return n}});var i=a(5720);const e=t=>{const{categoryId:s,goodsName:a,page:e}=t;return i.A.get("/goods/list",{params:{categoryId:s,goodsName:a,page:e}})},o=t=>i.A.get("/goods/detail",{params:{goodsId:t}}),n=t=>i.A.get("/comment/listRows",{params:{goodsId:t,limit:3}})}}]);
//# sourceMappingURL=669.e0cdd039.js.map